<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Audio Recorder</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: sans-serif;
            background: #2b2b2b;
        }
        button {
            width: 120px;
            height: 40px;
            margin: 10px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .record-btn {
            background-color: #1677ff;
            color: white;
        }
        .record-btn.recording {
            background-color: red;
        }
        .playback-btn {
            background-color: #52c41a;
            color: white;
        }
    </style>
</head>
<body>

<button class="record-btn">Record</button>
<button class="playback-btn">Playback</button>

<script>
    let mediaRecorder;
    let audioChunks = [];
    let audioStream = null;
    let isRecording = false;
    let currentAudio = null;

    const btnRecord = document.querySelector(".record-btn");
    const btnPlayback = document.querySelector(".playback-btn");

    btnRecord.addEventListener("click", async () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            if (isRecording) {
                // 停止录音
                mediaRecorder.stop();
                btnRecord.classList.remove("recording");
                btnRecord.textContent = "Record";
                isRecording = false;
            } else {
                // 开始录音
                try {
                    if (!audioStream) {
                        audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    }
                    audioChunks = [];
                    mediaRecorder = new MediaRecorder(audioStream);

                    mediaRecorder.ondataavailable = e => {
                        audioChunks.push(e.data);
                    };

                    mediaRecorder.start();
                    btnRecord.classList.add("recording");
                    btnRecord.textContent = "Recording...";
                    isRecording = true;
                } catch (err) {
                    console.error("无法访问麦克风:", err);
                }
            }
        } else {
            alert("你的浏览器不支持 getUserMedia。");
        }
    });

    btnPlayback.addEventListener("click", () => {
        if (audioChunks.length === 0) {
            alert("请先录音！");
            return;
        }

        if (btnPlayback.textContent === "Playback") {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audio = new Audio(audioUrl);
            currentAudio = audio;

            audio.addEventListener("ended", () => {
                btnPlayback.textContent = "Playback";
            });

            audio.play();
            btnPlayback.textContent = "Stop";
        } else {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            btnPlayback.textContent = "Playback";
        }
    });

    // 清理资源
    window.addEventListener("beforeunload", () => {
        if (audioStream) {
            audioStream.getTracks().forEach(track => track.stop());
        }
    });
</script>

</body>
</html>
